<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Polar Emotion Compass</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --emotion-color: transparent;
            --yellow: #ffd700;
            --light-grey: #444;
            --dark-grey: #1a1a1a;
            --bg-black: #0b0c10;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #0b0c10;
            color: #c5c6c7;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Left Panel - Glassmorphism */
        .left-panel {
            width: 35%;
            min-width: 250px;
            max-width: 60%;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            background: var(--dark-grey);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-right: 2px solid var(--light-grey);
            overflow-y: auto;
            position: relative;
        }

        /* Resize Handle */
        .resize-handle {
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            height: 100%;
            cursor: ew-resize;
            background: transparent;
            z-index: 100;
        }

        .resize-handle:hover {
            background: var(--yellow);
        }

        .left-panel h1 {
            font-size: 1.4rem;
            color: var(--yellow);
            text-align: center;
            margin-bottom: 0.8rem;
        }

        .context-section {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .section-title {
            font-size: 0.8rem;
            color: var(--yellow);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .pill {
            padding: 8px 16px;
            background: #1a2e20;
            color: #c5c6c7;
            border: none;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .pill:hover {
            background: #244030;
            transform: translateY(-1px);
        }

        .pill.active-pill {
            background: #2d5a3f;
            color: #fff;
            font-weight: 600;
        }

        .pill-add {
            background: rgba(255, 215, 0, 0.1);
            border: 1px dashed var(--yellow);
            color: var(--yellow);
        }

        .pill-add:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        /* Journal Area */
        .journal-section {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        textarea {
            width: 100%;
            min-height: 140px;
            padding: 1rem;
            background: var(--bg-black);
            border: 2px solid var(--light-grey);
            border-radius: 12px;
            color: #c5c6c7;
            font-size: 0.95rem;
            resize: vertical;
            font-family: inherit;
            box-shadow: 0 0 15px var(--emotion-color);
            transition: all 0.4s ease;
        }

        textarea:focus {
            outline: none;
            border-color: var(--yellow);
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 0.6rem;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            min-width: 120px;
            padding: 0.7rem 1rem;
            background: var(--yellow);
            color: #000;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        button:hover {
            background: #ffed4e;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #2a3f3e;
            color: #555;
            cursor: not-allowed;
            transform: none;
        }

        #status-message {
            padding: 0.7rem;
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid var(--light-grey);
            border-radius: 6px;
            text-align: center;
            font-size: 0.85rem;
            min-height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--yellow);
        }

        #status-message.success {
            background: rgba(32, 191, 107, 0.1);
            border-color: #20bf6b;
            color: #20bf6b;
        }

        #status-message.error {
            background: rgba(233, 69, 96, 0.1);
            border-color: #e94560;
            color: #e94560;
        }

        /* Right Panel */
        .right-panel {
            flex: 1;
            position: relative;
            background: var(--bg-black);
        }

        #wheel-container {
            width: 100%;
            height: 100%;
        }

        /* Emotion Bubbles */
        .emotion-node {
            cursor: pointer;
        }

        .emotion-node circle {
            transition: all 0.3s ease;
        }

        .emotion-node text {
            font-size: 9px;
            font-weight: 600;
            fill: #0b0c10;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        /* Tooltip */
        #tooltip {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1.5rem 2rem;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            border-top: 2px solid var(--light-grey);
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            pointer-events: none;
        }

        #tooltip.visible {
            transform: translateY(0);
            pointer-events: auto;
        }

        #tooltip h3 {
            font-size: 1.2rem;
            color: var(--yellow);
            margin-bottom: 0.5rem;
        }

        #tooltip p {
            font-size: 0.95rem;
            color: #c5c6c7;
            line-height: 1.5;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-black);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--light-grey);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--yellow);
        }
    </style>
</head>

<body>
    <!-- Left Panel -->
    <div class="left-panel" id="left-panel">
        <div class="resize-handle" id="resize-handle"></div>

        <h1>ðŸ§­ The Polar Emotion Compass</h1>

        <!-- Activities Section -->
        <div class="context-section">
            <div class="section-title">Activities</div>
            <div class="pills-container" id="pills-activities">
                <span class="pill" onclick="togglePill(this)">Placements</span>
                <span class="pill" onclick="togglePill(this)">Projects</span>
                <span class="pill" onclick="togglePill(this)">YouTube</span>
                <span class="pill pill-add" onclick="addCustomPill('pills-activities')">+</span>
            </div>
        </div>

        <!-- People Section -->
        <div class="context-section">
            <div class="section-title">People</div>
            <div class="pills-container" id="pills-people">
                <span class="pill" onclick="togglePill(this)">By Myself</span>
                <span class="pill" onclick="togglePill(this)">Friends</span>
                <span class="pill pill-add" onclick="addCustomPill('pills-people')">+</span>
            </div>
        </div>

        <!-- Places Section -->
        <div class="context-section">
            <div class="section-title">Places</div>
            <div class="pills-container" id="pills-places">
                <span class="pill" onclick="togglePill(this)">College</span>
                <span class="pill" onclick="togglePill(this)">Home</span>
                <span class="pill pill-add" onclick="addCustomPill('pills-places')">+</span>
            </div>
        </div>

        <!-- Journal Section -->
        <div class="journal-section">
            <div class="section-title">Journal Entry</div>
            <textarea id="journal-input" placeholder="What's on your mind?"></textarea>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button id="analyze-btn">Analyze Emotion</button>
            <button id="log-btn">Log Entry</button>
            <button id="download-btn">Download CSV</button>
        </div>

        <div id="status-message">Ready to analyze</div>
    </div>

    <!-- Right Panel -->
    <div class="right-panel">
        <svg id="wheel-container" width="100%" height="100%"></svg>

        <!-- Tooltip -->
        <div id="tooltip">
            <h3 id="tooltip-name"></h3>
            <p id="tooltip-desc"></p>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';

        // â”€â”€ Global State â”€â”€
        const userId = localStorage.getItem('user_id');
        const username = localStorage.getItem('username');
        const role = localStorage.getItem('user_role');

        // Auth Check
        if (!userId) {
            window.location.href = 'login.html';
        }

        // Role Check - Therapists should not be here
        if (localStorage.getItem('user_role') === 'therapist') {
            window.location.href = 'therapist_home.html';
        }

        // Display User Info & Navigation
        document.addEventListener('DOMContentLoaded', () => {
            const leftPanel = document.getElementById('left-panel');

            // Create Navigation Header
            const navHeader = document.createElement('div');
            navHeader.style.cssText = "display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #333;";

            const leftNav = document.createElement('div');
            leftNav.style.display = 'flex';
            leftNav.style.gap = '10px';
            leftNav.style.alignItems = 'center';

            const welcomeMsg = document.createElement('span');
            welcomeMsg.textContent = `Hi, ${username}`;
            welcomeMsg.style.cssText = "color: #888; font-size: 14px;";
            leftNav.appendChild(welcomeMsg);

            const rightNav = document.createElement('div');
            rightNav.style.display = 'flex';
            rightNav.style.gap = '10px';

            const dashboardBtn = document.createElement('button');
            dashboardBtn.textContent = "View Analytics";
            dashboardBtn.style.cssText = "background: transparent; color: #ffd700; border: 1px solid #444; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;";
            dashboardBtn.onclick = () => window.location.href = 'dashboard.html';

            const logoutBtn = document.createElement('button');
            logoutBtn.textContent = 'Logout';
            logoutBtn.style.cssText = "background: transparent; color: #ff6b6b; border: 1px solid #444; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;";
            logoutBtn.onclick = () => {
                localStorage.clear();
                window.location.href = 'login.html';
            };

            rightNav.appendChild(dashboardBtn);
            rightNav.appendChild(logoutBtn);

            navHeader.appendChild(leftNav);
            navHeader.appendChild(rightNav);

            // Insert at top of left panel
            leftPanel.insertBefore(navHeader, leftPanel.firstChild);
        });



        let emotionNodes = [];
        let currentSelectedEmotion = null;
        let currentEmotionData = null; // Stores current analysis result (emotion, radius, angle)
        let sessionData = [];
        let simulation = null;

        // â”€â”€ Color from angle â”€â”€
        function colorFromAngle(angle) {
            if (angle >= 330 || angle < 30) return '#f7b731'; // Joy â€“ Gold
            if (angle >= 30 && angle < 90) return '#e94560'; // Anger â€“ Red
            if (angle >= 90 && angle < 150) return '#e67e22'; // Fear â€“ Orange
            if (angle >= 150 && angle < 210) return '#3498db'; // Sad â€“ Blue
            if (angle >= 210 && angle < 270) return '#9b59b6'; // Disgust â€“ Purple
            return '#1abc9c';                                   // Peaceful â€“ Teal
        }

        // â”€â”€ Get color category from angle â”€â”€
        function getColorCategory(angle) {
            if (angle >= 330 || angle < 30) return 'Joy';
            if (angle >= 30 && angle < 90) return 'Anger';
            if (angle >= 90 && angle < 150) return 'Fear';
            if (angle >= 150 && angle < 210) return 'Sad';
            if (angle >= 210 && angle < 270) return 'Disgust';
            return 'Peaceful';
        }

        // â”€â”€ Set emotion color â”€â”€
        function setEmotionColor(hex) {
            document.documentElement.style.setProperty('--emotion-color', hex);
        }

        // â”€â”€ Status message helpers â”€â”€
        function showStatus(message, type = '') {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = type;
        }

        // â”€â”€ Tooltip helpers â”€â”€
        function showTooltip(name, desc) {
            document.getElementById('tooltip-name').textContent = name;
            document.getElementById('tooltip-desc').textContent = desc;
            document.getElementById('tooltip').classList.add('visible');
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('visible');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Context Pills Logic
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function togglePill(element) {
            element.classList.toggle('active-pill');
        }

        function addCustomPill(containerId) {
            const customText = prompt('Enter a custom tag:');
            if (!customText || !customText.trim()) return;

            const container = document.getElementById(containerId);
            const newPill = document.createElement('span');
            newPill.className = 'pill';
            newPill.textContent = customText.trim();
            newPill.onclick = () => togglePill(newPill);

            // Insert before the + button
            const addBtn = container.querySelector('.pill-add');
            container.insertBefore(newPill, addBtn);
        }

        function getActivePills(containerId) {
            const container = document.getElementById(containerId);
            const activePills = container.querySelectorAll('.pill.active-pill');
            return Array.from(activePills).map(pill => pill.textContent);
        }

        function clearAllActivePills() {
            document.querySelectorAll('.pill.active-pill').forEach(pill => {
                pill.classList.remove('active-pill');
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  D3 Wheel Setup
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadWheel() {
            let data;
            try {
                const res = await fetch(`${API_URL}/emotions`);
                data = await res.json();
            } catch (err) {
                console.error('Cannot reach API:', err);
                showStatus('Failed to load emotion wheel. Is the server running?', 'error');
                return;
            }

            const svg = d3.select('#wheel-container');
            const { width, height } = svg.node().getBoundingClientRect();
            const cx = width / 2;
            const cy = height / 2;
            const maxWheelRadius = Math.min(width, height) * 0.4;

            // Build node array with target positions
            emotionNodes = Object.entries(data).map(([name, v]) => {
                const angleRad = (v.angle * Math.PI) / 180;
                const targetX = cx + (v.radius * maxWheelRadius) * Math.cos(angleRad);
                const targetY = cy + (v.radius * maxWheelRadius) * Math.sin(angleRad);

                return {
                    id: name,
                    name,
                    radius: v.radius,
                    angle: v.angle,
                    energy: v.energy,
                    desc: v.desc || v.description || '',
                    color: colorFromAngle(v.angle),
                    r: 32,
                    targetX,
                    targetY,
                    x: targetX,
                    y: targetY
                };
            });

            // Background rings
            const ringsG = svg.append('g').attr('class', 'rings');
            [0.25, 0.5, 0.75, 1.0].forEach(frac => {
                ringsG.append('circle')
                    .attr('cx', cx)
                    .attr('cy', cy)
                    .attr('r', maxWheelRadius * frac)
                    .attr('fill', 'none')
                    .attr('stroke', '#1f2833')
                    .attr('stroke-width', 1);
            });

            // Node groups
            const nodeG = svg.append('g').attr('class', 'nodes');

            const groups = nodeG.selectAll('g.emotion-node')
                .data(emotionNodes)
                .enter()
                .append('g')
                .attr('class', 'emotion-node')
                .on('click', (event, d) => highlightNode(d.id))
                .on('dblclick', (event, d) => {
                    event.stopPropagation();
                    showTooltip(d.name, d.desc);
                });

            groups.append('circle')
                .attr('r', d => d.r)
                .attr('fill', d => d.color)
                .attr('stroke', 'none')
                .attr('stroke-width', 3)
                .attr('opacity', 0.9);

            groups.append('text')
                .text(d => d.name)
                .attr('font-size', '9px');

            // Click background to hide tooltip
            svg.on('click', (event) => {
                if (event.target === svg.node()) hideTooltip();
            });

            // D3 Force Simulation (static positioning)
            simulation = d3.forceSimulation(emotionNodes)
                .force('x', d3.forceX(d => d.targetX).strength(1))
                .force('y', d3.forceY(d => d.targetY).strength(1))
                .force('collide', d3.forceCollide().radius(35).iterations(2))
                .alpha(1)
                .alphaDecay(0.05)
                .on('tick', () => {
                    groups.attr('transform', d => `translate(${d.x},${d.y})`);
                });

            // Store groups globally for highlightNode
            window.emotionGroups = groups;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Highlight Node Function
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function highlightNode(nodeName) {
            console.log('highlightNode called with:', nodeName);
            hideTooltip();

            // Check if wheel is loaded
            if (!window.emotionGroups) {
                console.error('Wheel not loaded yet. emotionGroups is undefined.');
                showStatus('Please wait for the wheel to load', 'error');
                return;
            }

            const node = emotionNodes.find(n => n.id === nodeName);
            if (!node) {
                console.error('Node not found:', nodeName);
                console.log('Available emotions:', emotionNodes.map(n => n.id));
                showStatus(`Emotion "${nodeName}" not found`, 'error');
                return;
            }

            currentSelectedEmotion = nodeName;

            // Update currentEmotionData when manually clicking
            if (!currentEmotionData || currentEmotionData.emotion !== nodeName) {
                currentEmotionData = {
                    emotion: nodeName,
                    radius: node.radius,
                    angle: node.angle
                };
            }

            // Update all nodes
            window.emotionGroups.select('circle')
                .transition().duration(300)
                .attr('r', d => d.id === nodeName ? 55 : 32)
                .attr('stroke', d => d.id === nodeName ? '#ffffff' : 'none')
                .attr('opacity', d => d.id === nodeName ? 1 : 0.3);

            window.emotionGroups.select('text')
                .transition().duration(300)
                .attr('font-size', d => d.id === nodeName ? '13px' : '9px');

            // Update emotion color for journal glow
            setEmotionColor(node.color);

            console.log('Successfully highlighted:', nodeName);
            showStatus(`Selected: ${nodeName}`, 'success');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Button Handlers
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Analyze Button
        document.getElementById('analyze-btn').addEventListener('click', async () => {
            const text = document.getElementById('journal-input').value.trim();
            if (!text) {
                showStatus('Please write something in the journal first', 'error');
                return;
            }

            // Check if wheel is loaded
            if (!window.emotionGroups || emotionNodes.length === 0) {
                showStatus('Please wait for the emotion wheel to load', 'error');
                return;
            }

            const btn = document.getElementById('analyze-btn');
            btn.textContent = 'Analyzing...';
            btn.disabled = true;
            showStatus('Analyzing your text...', '');

            try {
                const res = await fetch(`${API_URL}/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });
                const result = await res.json();

                console.log('API response:', result);

                // Store the analysis result
                currentEmotionData = {
                    emotion: result.emotion,
                    radius: result.radius,
                    angle: result.angle
                };

                highlightNode(result.emotion);
            } catch (err) {
                console.error('Analysis failed:', err);
                showStatus('Analysis failed. Is the server running?', 'error');
            } finally {
                btn.textContent = 'Analyze Emotion';
                btn.disabled = false;
            }
        });

        // Log Entry Button
        document.getElementById('log-btn').addEventListener('click', async () => {
            const text = document.getElementById('journal-input').value.trim();

            if (!text) {
                showStatus('Please write a journal entry first', 'error');
                return;
            }

            if (!currentSelectedEmotion || !currentEmotionData) {
                showStatus('Please analyze or select an emotion first', 'error');
                return;
            }

            // Gather context
            const activities = getActivePills('pills-activities');
            const people = getActivePills('pills-people');
            const places = getActivePills('pills-places');

            // Get color category from angle
            const colorCategory = getColorCategory(currentEmotionData.angle);

            // Create log request (NO TEXT - privacy first!)
            const logData = {
                user_id: parseInt(userId),
                emotion: currentEmotionData.emotion,
                radius: currentEmotionData.radius,
                angle: currentEmotionData.angle,
                color_category: colorCategory,
                activities: activities,
                people: people,
                places: places
            };

            const btn = document.getElementById('log-btn');
            btn.textContent = 'Logging...';
            btn.disabled = true;

            try {
                // Send to database (no journal text)
                const res = await fetch(`${API_URL}/log`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(logData)
                });
                const result = await res.json();

                console.log('Log saved:', result);

                // Clear and reset
                document.getElementById('journal-input').value = '';
                clearAllActivePills();
                showStatus('Successfully Logged to Database!', 'success');

                // Reset after 2 seconds
                setTimeout(() => showStatus('Ready to analyze', ''), 2000);
            } catch (err) {
                console.error('Log failed:', err);
                showStatus('Failed to save log. Is the server running?', 'error');
            } finally {
                btn.textContent = 'Log Entry';
                btn.disabled = false;
            }
        });

        // Download CSV Button
        document.getElementById('download-btn').addEventListener('click', async () => {
            const btn = document.getElementById('download-btn');
            btn.textContent = 'Downloading...';
            btn.disabled = true;

            try {
                // Fetch history from database for THIS user
                const res = await fetch(`${API_URL}/logs/${userId}`);
                const history = await res.json();

                if (history.length === 0) {
                    showStatus('No data to export. Log some entries first!', 'error');
                    btn.textContent = 'Download CSV';
                    btn.disabled = false;
                    return;
                }

                // Build CSV
                const headers = ['Timestamp', 'Emotion', 'Intensity (Radius)', 'Angle', 'Category', 'Activities', 'People', 'Places'];
                const rows = history.map(entry => {
                    const activities = entry.activities.join('; ') || 'None';
                    const people = entry.people.join('; ') || 'None';
                    const places = entry.places.join('; ') || 'None';

                    return [
                        entry.timestamp,
                        entry.emotion,
                        entry.radius.toFixed(2),
                        entry.angle.toFixed(1),
                        entry.color_category,
                        activities,
                        people,
                        places
                    ].join(',');
                });

                const csvContent = [headers.join(','), ...rows].join('\n');

                // Create and download
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `emotion_logs_${new Date().toISOString().slice(0, 10)}.csv`;
                link.click();
                URL.revokeObjectURL(url);

                showStatus(`Downloaded ${history.length} entries from database`, 'success');
                setTimeout(() => showStatus('Ready to analyze', ''), 2000);
            } catch (err) {
                console.error('Download failed:', err);
                showStatus('Failed to download. Is the server running?', 'error');
            } finally {
                btn.textContent = 'Download CSV';
                btn.disabled = false;
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Resizable Left Panel
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const resizeHandle = document.getElementById('resize-handle');
        const leftPanel = document.getElementById('left-panel');
        let isResizing = false;

        resizeHandle.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.body.style.cursor = 'ew-resize';
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;

            const newWidth = e.clientX;
            const minWidth = 250;
            const maxWidth = window.innerWidth * 0.6;

            if (newWidth >= minWidth && newWidth <= maxWidth) {
                leftPanel.style.width = `${newWidth}px`;
            }
        });

        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
            }
        });

        // â”€â”€ Init â”€â”€
        window.addEventListener('load', loadWheel);
    </script>
</body>

</html>